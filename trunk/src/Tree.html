<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<head>
		<title>My JSP 'Combobox.jsp' starting page</title>

		<meta http-equiv="pragma" content="no-cache">
		<meta http-equiv="cache-control" content="no-cache">
		<meta http-equiv="expires" content="0">
		<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
		<meta http-equiv="description" content="This is my page">
		<!--
			<link rel="stylesheet" type="text/css" href="styles.css">
		-->
		<script type="text/javascript" src="js/Common.js"></script>
		<script type="text/javascript" src="js/Url.js"></script>
		<script type="text/javascript" src="js/Map.js"></script>
		<script type="text/javascript" src="js/Shell.js"></script>
		<script type="text/javascript" src="js/log4js.js"></script>
		<script type="text/javascript" src="js/ImageList.js"></script>
		<script type="text/javascript" src="js/TreeNode.js"></script>
		<script type="text/javascript" src="js/Tree.js"></script>
		<script type="text/javascript" src="js/MenuItem.js" ></script>
		<script type="text/javascript" src="js/PopupMenu.js" ></script>
		<script type="text/javascript">	
		var icons=new ImageList();
		window.onload=function(){
			icons.add("images/p.gif","expand");
			icons.add("images/m.gif","collapse");
			icons.add("images/Fp.gif","expand_top");
			icons.add("images/Tp.gif","expand_mid");
			icons.add("images/Lp.gif","expand_end");
			icons.add("images/Fm.gif","collapse_top");
			icons.add("images/Tm.gif","collapse_mid");
			icons.add("images/Lm.gif","collapse_end");
			icons.add("images/T.gif","leaf");
			icons.add("images/F.gif","leaf_top");
			icons.add("images/L.gif","twig");
			icons.add("images/I.gif","line");
			icons.add("images/b.gif","blank");
			icons.add("images/file.gif","default");
			
			window.tree=new Tree(icons,16,"cont");
			tree.setLineStyle(true);
			window.gNode=new TreeNode(tree,"demos","demo","images/global.gif");
			gNode.setStyle("font-size:18px;font-weight:bold;");
			tree.addNode(tree.root,gNode);
			
			//here add many kinds of callback of the tree's dom event
			tree.onclick=test_onclick;
			tree.oncontextmenu=test_oncontextmenu;
			//check event
			tree.oncheck=function(node){
				var msg=node.caption+" is " + (node.isChecked()?"":"not") + " checked.\n";
				//this get all the checked nodes of the tree
				var chknodes=tree.getCheckedNodes();
				for(var i=0;i<chknodes.length;i++){
					msg+=chknodes[i].caption + " ,";
				}
				msg+="\nis checked on the tree";
				alert(msg);
			};
			//radio change event
			tree.onrdocheckchanged=function(parentNode,eve){
				var msg="the parent node is "+parentNode.caption;
				
				//you can use getCheckedRadio to get the checked radiobox from one node
				msg+="\nprevious checked radio is " + eve.orgNode.caption + " and current checked radio is " + eve.curNode.caption;
				
				alert(msg);
			};			
		}
		
		//addNode
		function test_addNode(){
			gNode.removeChildren();
			var pe=new Date();
			for (var i=0;i<10;i++){				
				var node = new TreeNode(tree,i,"","","","","","","");
				tree.addNode(gNode,node);
			}					
			var pd=new Date();
			//alert("cost " + (pd-pe) + " ms");				
		}	
		
		//addNodes
		function test_addNodes(){
			gNode.removeChildren();
			var nodes=[];
			for (var i=0;i<10;i++){				
				nodes[i] = ["nodes"+i,"","","","","","",""];				
			}
			var pe=new Date();
			tree.addNodes(gNode,nodes);
			var pd=new Date();
			//alert("cost " + (pd-pe) + " ms");		
		}
		
		//event		
		//onclick
		function test_onclick(node){
			alert(node.caption);
		}
		
		//oncontextmenu
		function test_oncontextmenu(node){
			//it is just a callback,the contextmenu need you to handle it by youself
			if (!node.contmenu){
				node.contmenu=new PopupMenu();
			}
			node.contmenu.removeitemAll();
			var item = new MenuItem(node.caption);
			node.contmenu.additem(item);
			
			node.contmenu.show();	
		}	
		
		//find by key
		function test_findByKey(){
//			find the node by the key of the node "demo"
			tree.nodes["demo"].select();
		}		
		
		//lazy-loading
		function test_lazyloading(){
			gNode.removeChildren();
			var ln=new TreeNode(tree,"lazyloading",null,null,null,null,"always");
			
			ln.onexpand=function(){
				ln.removeChildren();
				ln.setCaption("loading.....");
				var inv=window.setInterval(function(){			
					tree.addNode(ln,new TreeNode(tree,"lazy-1"));
					tree.addNode(ln,new TreeNode(tree,"lazy-2"));
					ln.setCaption("done");				
					window.clearInterval(inv);
				},3000);
			};			
			
			tree.addNode(gNode,ln);
		}
		
		//checkbox
		function test_checkbox(){
			gNode.removeChildren();
			
			for(var i=0;i<5;i++){
				var node=new TreeNode(tree,"checkbox"+i,null,null,null,null,null,null,null,Tree.CHECKBOX);			
				tree.addNode(gNode,node);
				//note:this method can't be called before this node is added to the tree
				node.setChecked(true);
			}			
		}
		
		//radiobox
		function test_radiobox(){
			gNode.removeChildren();

			for(var i=0;i<5;i++){
				var node=new TreeNode(tree,"radiobox"+i,null,null,null,null,null,null,null,Tree.RADIOBOX);						
				tree.addNode(gNode,node);
				//note:this method can't be called before this node is added to the tree			
				node.setRadioCheck();
			}
		}
		
		//performance
		function test_performance(type){			
			if (window.win){
				window.win.close();
			}
			if (type){
				window.win=window.open("pt.html?t=1&n="+$("pn").value);
			}else{
				window.win=window.open("pt.html?t=0&n="+$("pn").value);
			}
		}		
	</script>
	</head>

	<body>
		<table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td style="width:30%;">
					<span id="cont"></span>
				</td>
				<td valign="top">
					<table border="0" cellpadding="0" cellspacing="0" width="100%">
						<tr>
							<td>
								<button onclick="test_addNode();">add node</button>	
							</td>
							<td>
								
							</td>
						</tr>
						
						<tr>
							<td>
								<button onclick="test_addNodes();">add nodes</button>	
							</td>
							<td>
								
							</td>
						</tr>
						
						<tr>
							<td>
								<button onclick="test_findByKey();">find node by key,then select</button>	
							</td>
							<td>
								
							</td>
						</tr>
						
						<tr>
							<td>
								<button onclick="test_lazyloading();">lazy loading</button>	
							</td>
							<td>
								
							</td>
						</tr>
						
						<tr>
							<td>
								<button onclick="test_checkbox();">check box test</button>	
							</td>
							<td>
								
							</td>
						</tr>
						
						<tr>
							<td>
								<button onclick="test_radiobox();">radio box test</button>	
							</td>
							<td>
								
							</td>
						</tr>
						
						<tr>
							<td>
								the nodes your want to load: <input type="text" id="pn" value="1000" ><br/>
								<button onclick="test_performance(false);">performance test for addNode</button><br/>	
								<button onclick="test_performance(true);">performance test for addNodes</button>	
							</td>
							<td>
								the aim of the method addNodes is to improve the performance of the tree when load large number
								of nodes,but we may doubt if we need to do this.To load a tree with more than 200 nodes,and let 
								user to select from one of them in the UI?I think it is a bad smell.<br/>
								But I have work hard to give this a method,I use it in a project,and have test it many many times.
								I think it useful to share these experience.<br/>
								The biggest check point is the image,do not handle the image filter by youself,and let the container
								do it.On a dynamic web site,the IE can load 2000 nodes in one-time mode and 7000 totally in lazy-loading
								mode.Firefox is work well when loading 8000+,I didn't test anymore.<br/>
								As this test is a static local environment,I show the result here I have Test:<BR/>
								<table border="0" cellpadding="2" cellspacing="0" width="100%">
									<tr>
										<td>
											nodes number
										</td>										
										<td colspan="2">
											IE6
										</td>										
										<td colspan="2">
											Firefox2.0
										</td>
									</tr>
									<tr>
										<td>
										</td>
										<td>
											addNode cost time(ms)
										</td>
										<td>
											addNodes cost time(ms)
										</td>
										<td>
											addNode cost time(ms)
										</td>
										<td>
											addNodes cost time(ms)
										</td>
									</tr>
									<tr>
										<td>
											1000
										</td>
										<td>
											4578
										</td>
										<td>
											3219
										</td>
										<td>
											3267
										</td>
										<td>
											2753
										</td>
									</tr>
									<tr>
										<td>
											2000
										</td>
										<td>
											10375
										</td>
										<td>
											7203
										</td>
										<td>
											6794
										</td>
										<td>
											5614
										</td>
									</tr>
									<tr>
										<td>
											3000
										</td>
										<td>
											18843
										</td>
										<td>
											12079
										</td>
										<td>
											10218
										</td>
										<td>
											8524
										</td>
									</tr>
									<tr>
										<td>
											10000
										</td>
										<td>
											118625
										</td>
										<td>
											62844
										</td>
										<td>
											41416
										</td>
										<td>
											34945
										</td>
									</tr>
								</table>	
							</td>
						</tr>
					</table>
				</td>
			</tr>
		</table>
		
		
	</body>
</html>
